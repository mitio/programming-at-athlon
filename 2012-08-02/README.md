## Материали и ресурси

Слайдове:

- От: http://fmi.ruby.bg/lectures/02-arrays-hashes-functions#48
- До: края на презентацията

За любознателните, връзки към документацията на `Enumerable#inject`, както и до Ruby-имплементация
на `inject` от алтернативния Ruby интерпретатор [Rubinius](http://rubini.us/):

- http://ruby-doc.org/core-1.9.3/Enumerable.html#method-i-inject
- https://github.com/rubinius/rubinius/blob/master/kernel/common/enumerable.rb и търсете за "inject"

Днес написахме и два файла, демонстриращи работа с блокове:

- [blocks.rb](https://github.com/mitio/programming-at-athlon/blob/master/2012-08-02/blocks.rb) демонстрира `yield`
- [html_builder.rb](https://github.com/mitio/programming-at-athlon/blob/master/2012-08-02/html_builder.rb) е
  доста сложна демонстрация, включваща взимане на блокове в променлива (`&block`), предаване на блокове
  по-надолу по веригата пак с `&`, например `render(&block)`, употреба на `method_missing` както и на
  `instance_eval`. Последните две неща са сложни и не му е времето да задълбавате сега в тях, така че може
  спокойно да ги пропуснете. В тази демонстрация се вижда как си правим DSL (domain-specific language)
  за писане на HTML с помощта на блоковете в Ruby:

  ![HTML DSL чрез блокове в Ruby](http://dl.dropbox.com/u/2664150/Screenshots/704lqt6etg32.png)

  Примерът не генерира 100% валиден HTML, не escape-ва имена и стойности атрибути и т.н., но това не е
  трудно да се направи и оставяме за упражнение на желаещите да го допълнят.

## Домашното за следващия път

За да решите следващото домашно, ще ви се налага да работите с файлове и директории и да ползвате съответните
класове в Ruby за целта. Може да се подготвите, като хвърлите едно око на документацията на `Dir`, `Dir#glob` и `File`.

Няколко подсказки накратко:

#### Как да пишете във файл

След изпълнението на кода по-долу, в текущата директория (най-вероятно папката с файла с кода)
ще имате файл `gallery.html` със съдържание `<html><p>Hey!<p></html>`:

	File.open('gallery.html', 'w') do |file|
	  file.write '<html>'
	  file.write '<p>Hey!</p>'
	  file.write '</html>'
	end

Вижте и другите [методи на File](http://www.ruby-doc.org/core-1.9.3/File.html).

#### Обхождане на файлове и директории

Това става най-лесно с `Dir#glob` (за което краткият вариант е [`Dir#[]`](http://www.ruby-doc.org/core-1.9.3/Dir.html#method-c-5B-5D)).
Например следното ще ви върне списък с всички файлове и директории (на едно ниво дълбочина) от текущата директория:

	Dir['*']

Този списък може да обхождате по стандартния начин с `#each`.

Кодът по-долу ще ви върне списък с всички файлове, завършващи на ".rb" в текущата директория
или в която и да е нейна поддиректория:

	Dir['**/*.rb']

Вижте [документацията на `Dir`](http://www.ruby-doc.org/core-1.9.3/Dir.html) за повече информация.

#### Unicode

Ако искате да имате кирилица (или каквито и да е други unicode-символи) във вашия .rb файл,
се уверете, че го запазвате с кодиране UTF-8 (повечето редактори правят това така или иначе) и
не забравяйте като първи ред на файла да поставите това:

	# encoding: utf-8

#### Прочитане на метаданни (EXIF) от снимка

За да се справите с домашното, ще ви е необходимо да можете да извличате метаданни, още известни като
EXIF, от JPEG-изображения. Това може да стане лесно в Ruby, тъй като съществуват готови библиотеки
за целта. Библиотеките в Ruby се наричат gems и 99% от тях са безплатни и с отворен код, следвайки
духа на езика и общността около него.

За нашите конкретни цели ще ни трябва библиотеката `exifr`. Ruby библиотеки се инсталират с помощта
на конзолната команда `gem`:

	gem install exifr

След като изпълните горния ред във вашия терминал/command prompt, ще разполагате с инсталиран вариант
на [библиотеката EXIF Reader (код и документация)](https://github.com/remvee/exifr/). От там нататък,
четенето на метаданни е тривиално. Например, в `irb`:

	irb> require 'exifr'
	irb> exif = EXIFR::JPEG.new('Photos/IMG_0706.JPG')
	irb> puts exif.width, exif.height, exif.model, exif.date_time, exif.gps

#### Дати и часове

Работата с дати и часове, която ще се наложи да извършите за тази задача, се ограничава в рамките
на класа `Time`. Вижте [документацията на `Time`](http://www.ruby-doc.org/core-1.9.3/Time.html)
за повече информация какви методи имат обектите, представляващи време в Ruby.

### Предоставени ресурси

Предоставя ви се архив `Photos.zip`, съдържащ папка `Photos` с няколко дузини JPEG-файла вътре.
Имената на файловете са във вида `IMG_XXXX.JPG`, където символите `X` са заместени от цифра.
JPEG-файловете имат метаданни в EXIF-секцията си — дата на снимане, географски координати,
фотоапарат и т.н.

**Връзка към архива със снимки**: [https://dl.dropbox.com/u/2664150/Photos.zip](https://dl.dropbox.com/u/2664150/Photos.zip)

### Задача 1 — разместване на файлове

Задачата ви е да обходите JPEG-файловете от предоставената папка `Photos`, да прочетете метаданните
им и да ги разположите в папки според датата им на заснемане, записана във въпросните метаданни.
Трябва да бъде създадена папка в текущата директория, в която се намира вашият Ruby код, която се казва
`Library`. Ако файл е сниман на 17 май 2011 г. и се казва `IMG_XXXX.JPG`, то той трябва да бъде
разположен на следното място в `Library`:

	Library/2011/May/17/IMG_XXXX.JPG

Снимките, които нямат дата на заснемане в метаданните, трябва да отиват в `Library/Sometime/<файл>`.
Препоръчително е да местите файловете по местата им, а не да ги копирате, но това не е задължително.

### Задача 2 — галерия

Целта е да генерирате прост HTML-файл, кръстен `Gallery.html`, разположен в папката `Library`:

	Library/Gallery.html

Този файл трябва да съдържа снимките от задача 1, вече разпределени в `Library`, подредени по дати
на заснемане, от най-новите към най-старите. Снимките без дата отиват най-отдолу.
Стриктни изисквания към интерфейса няма, стига да наподобява нещо като
[Big Picture](http://boston.com/bigpicture/), т.е. дълга страница снимки, замеащи почти цялата
ширина на екрана. Не е нужно да преоразмерявате картинките предварително, може да оставите тази работа
на браузъра. Очаква се да групирате снимките по месеци и да покажете годината и месеца, за които е
съответната група снимки, в голямо заглавие. Например:

	<h1>May 2011</h1>
	Снимка 1
	Снимка 2
	Снимка 3...

	<h1>November 2010</h1>
	Снимка 1
	Снимка 2...

	<h1>Sometime</h1>
	Снимка 1
	Снимка 2...

Под/около всяка снимка се изисква да се показват детайли, извлечени от нейните метаданни — дата и час
на снимане, с каква камера/фотоапарат е направена, географски координати, ако има такива. Можете да
добавите и други метаданни, ако смятате, че ще са интересни за гледащия.

Географските координати, ако такива има, трябва да са придружени с линк към Google Maps, на който
да се вижда точката на заснемане на снимката.

Като незадължителна бонус част, за тези от вас, които се чувстват смели, е необходимо да се интегрира
една Google Maps карта за цялата страница Gallery.html, на която с pin-ове или по някакъв друг начин
са отбелязани всички снимки на съответната им локация.

### Срок

Тъй като пропускаме сбирката на 9-ти август, ще се видим чак на 16-ти и срокът за домашното е до тогава.
Въпреки това се постарайте да го направите и предадете по-рано.

